const a1_0x3af8=['__esModule','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','subscribe','Executed\x20tasks\x20with\x20hashes:\x20','catch','map','./cloud-remote-cache','./id-generator','/runs/','next','../../../utilities/nx-imports','Nx\x20Cloud\x20Problems','requests','join','obfuscate','exit','cacheableOperations','toISOString','submitRunMetrics','error','filter','VERBOSE_LOGGING','api.nrwl.io','lifeCycle','taskId','EndOfRunMessage','url','CloudRemoteCache','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','../../file-storage/e2e-encryption','indexOf','getBranch','CloudEnabledLifeCycle','../../../utilities/metric-logger','rxjs/internal/Subject','anyErrors','cacheDirectory','printCacheHitsMessage','waitForStoreRequestsToComplete','runUrl','env','parseCommand','E2EEncryption','push','daemon','path','cachePath','../../file-storage/file-storage','.commit','accessToken','apply','cloudEnabledTasksRunner','../../terminal-output/end-of-run-message','extractGitSha','writeFileSync','tasks-hashes-','../../terminal-output/message-reporter','processInBackground','hash','localhost','skipNxCache','./node_modules/.cache/nx','pathExists','../../terminal-output/output-obfuscator','maskedProperties','enabled','ACCESS_TOKEN','../../../utilities/environment','scan','done','startRun','encryptionKey','__awaiter','note','./cloud-enabled-life-cycle','endsWith','printMessages','length','assign','then','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION'];(function(_0x198371,_0x3af8a9){const _0x4e66e5=function(_0x348588){while(--_0x348588){_0x198371['push'](_0x198371['shift']());}};_0x4e66e5(++_0x3af8a9);}(a1_0x3af8,0xcf));const a1_0x4e66=function(_0x198371,_0x3af8a9){_0x198371=_0x198371-0x0;let _0x4e66e5=a1_0x3af8[_0x198371];return _0x4e66e5;};'use strict';var __awaiter=this&&this[a1_0x4e66('0x1b')]||function(_0xd14e5b,_0x1b3ade,_0x5e7e94,_0x28687b){function _0x409961(_0x1ed129){return _0x1ed129 instanceof _0x5e7e94?_0x1ed129:new _0x5e7e94(function(_0x54e226){_0x54e226(_0x1ed129);});}return new(_0x5e7e94||(_0x5e7e94=Promise))(function(_0xdcbd87,_0x15783d){function _0x2e4cf7(_0x815e9a){try{_0x370b43(_0x28687b[a1_0x4e66('0x2d')](_0x815e9a));}catch(_0x674f33){_0x15783d(_0x674f33);}}function _0x1f224d(_0x383908){try{_0x370b43(_0x28687b['throw'](_0x383908));}catch(_0x673d01){_0x15783d(_0x673d01);}}function _0x370b43(_0x42cc07){_0x42cc07[a1_0x4e66('0x18')]?_0xdcbd87(_0x42cc07['value']):_0x409961(_0x42cc07['value'])[a1_0x4e66('0x22')](_0x2e4cf7,_0x1f224d);}_0x370b43((_0x28687b=_0x28687b[a1_0x4e66('0x5')](_0xd14e5b,_0x1b3ade||[]))[a1_0x4e66('0x2d')]());});};Object['defineProperty'](exports,a1_0x4e66('0x24'),{'value':!![]});exports[a1_0x4e66('0x6')]=void 0x0;const message_reporter_1=require(a1_0x4e66('0xb'));const end_of_run_message_1=require(a1_0x4e66('0x7'));const output_obfuscator_1=require(a1_0x4e66('0x12'));const cloud_enabled_life_cycle_1=require(a1_0x4e66('0x1d'));const file_storage_1=require(a1_0x4e66('0x2'));const e2e_encryption_1=require(a1_0x4e66('0x41'));const environment_1=require(a1_0x4e66('0x16'));const cloud_remote_cache_1=require(a1_0x4e66('0x2a'));const cloud_run_api_1=require('./cloud-run.api');const fs_1=require('fs');const path=require(a1_0x4e66('0x0'));const metric_logger_1=require(a1_0x4e66('0x45'));const error_reporter_api_1=require('../../api/error-reporter.api');const path_1=require(a1_0x4e66('0x0'));const fs_extra_1=require('fs-extra');const id_generator_1=require(a1_0x4e66('0x2b'));const {tasksRunner,output,Cache}=require(a1_0x4e66('0x2e'));function createApi(_0x39c45e,_0x521377,_0x523ad2){const _0x4b9261=(0x0,environment_1['getMachineInfo'])(_0x521377);return new cloud_run_api_1['CloudRunApi'](_0x39c45e,_0x523ad2,_0x521377,_0x4b9261);}function storeTaskHashes(_0xb190d2,_0x44c9a8,_0x39b19c){const _0x316be5=JSON['stringify'](_0xb190d2[a1_0x4e66('0x29')](_0x269a93=>({'taskId':_0x269a93[a1_0x4e66('0x3c')],'hash':_0x269a93[a1_0x4e66('0xd')]})));if(environment_1[a1_0x4e66('0x39')]){output[a1_0x4e66('0x1c')]({'title':a1_0x4e66('0x27')+_0x316be5});}(0x0,fs_1[a1_0x4e66('0x9')])(path[a1_0x4e66('0x31')](_0x44c9a8,a1_0x4e66('0xa')+_0x39b19c),_0x316be5);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x45320b=new Date()['toISOString']();const _0x20fac4=(0x0,environment_1[a1_0x4e66('0x43')])();const _0x472e4a={'command':outputObfuscator[a1_0x4e66('0x32')]((0x0,environment_1[a1_0x4e66('0x4d')])()),'startTime':runStartTime,'endTime':_0x45320b,'distributedExecutionId':environment_1[a1_0x4e66('0x40')],'branch':_0x20fac4,'scan':!![],'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x20fac4?(0x0,environment_1[a1_0x4e66('0x8')])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x4e66('0x23')]){storeTaskHashes(taskExecutions,options[a1_0x4e66('0x48')]||a1_0x4e66('0x10'),environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID']);}try{yield remoteCache[a1_0x4e66('0x4a')]();}catch(_0x534d1f){output['error']({'title':'Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.'});messages[a1_0x4e66('0x1f')]();process[a1_0x4e66('0x33')](environment_1[a1_0x4e66('0x25')]);}try{yield api['endRun'](_0x472e4a,taskExecutions);}catch(_0x59bddd){output[a1_0x4e66('0x37')]({'title':'Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.'});messages[a1_0x4e66('0x1f')]();process['exit'](environment_1[a1_0x4e66('0x25')]);}yield(0x0,metric_logger_1[a1_0x4e66('0x36')])(options);}else{try{const _0x41467d=environment_1['ACCESS_TOKEN']?environment_1[a1_0x4e66('0x15')]:options[a1_0x4e66('0x4')];const _0x34ae83=(0x0,id_generator_1['generateUniqueLinkId'])();yield daemon[a1_0x4e66('0xc')]('@nrwl/nx-cloud/lib/daemon/process-run-end',{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x4e66('0x21')](Object[a1_0x4e66('0x21')]({},options),{'accessToken':_0x41467d}),'uploads':fileStorage['uploads'],'runEnd':{'runData':_0x472e4a,'taskExecutions':taskExecutions,'linkId':_0x34ae83}});runContext[a1_0x4e66('0x4b')]=(options[a1_0x4e66('0x3e')]||'https://nx.app')+a1_0x4e66('0x2c')+_0x34ae83;}catch(_0x544aba){output['warn']({'title':a1_0x4e66('0x2f'),'bodyLines':[_0x544aba['message']||_0x544aba['toString']()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x4e66('0x1f')]();if(!messages[a1_0x4e66('0x47')]&&!inner){endOfRunMessage[a1_0x4e66('0x49')]();}},0x0);}else{messages[a1_0x4e66('0x1f')]();if(!messages[a1_0x4e66('0x47')]&&!inner){endOfRunMessage[a1_0x4e66('0x49')]();}}});}function createLifeCycle(_0x2051d9,_0x18ac3b,_0x13ccee,_0x36a370){const _0x57b15a=new cloud_enabled_life_cycle_1[(a1_0x4e66('0x44'))](_0x2051d9,_0x18ac3b[a1_0x4e66('0x48')],!!_0x18ac3b[a1_0x4e66('0xf')],_0x18ac3b[a1_0x4e66('0x17')]===undefined?!![]:_0x18ac3b[a1_0x4e66('0x17')],_0x18ac3b[a1_0x4e66('0x34')]||[],_0x13ccee,_0x36a370);try{const {CompositeLifeCycle}=require(a1_0x4e66('0x2e'));if(!CompositeLifeCycle)return _0x57b15a;return new CompositeLifeCycle([_0x18ac3b[a1_0x4e66('0x3b')],_0x57b15a]);}catch(_0x18aca5){return _0x57b15a;}}function fetchUrlsForKnownHashesUpfront(_0x2c1180,_0x1e701c,_0x485abb,_0x120d22){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x459feb=_0x485abb[a1_0x4e66('0x29')](_0x5c2236=>_0x5c2236[a1_0x4e66('0xd')])[a1_0x4e66('0x38')](_0x110044=>!!_0x110044);const _0x4a0269=new Cache(_0x120d22);if(!_0x120d22[a1_0x4e66('0xf')]){const _0x119d97=yield Promise['all'](_0x459feb['map'](_0x5c5ddd=>{const _0x5a9fca=(0x0,path_1[a1_0x4e66('0x31')])(_0x4a0269[a1_0x4e66('0x1')],_0x5c5ddd+a1_0x4e66('0x3'));return(0x0,fs_extra_1[a1_0x4e66('0x11')])(_0x5a9fca);}));const _0x4a3f86=[];for(let _0x560fbc=0x0;_0x560fbc<_0x119d97[a1_0x4e66('0x20')];++_0x560fbc){if(_0x119d97[_0x560fbc]){_0x4a3f86[a1_0x4e66('0x4f')](_0x459feb[_0x560fbc]);}}_0x459feb=_0x4a3f86;}if(_0x459feb[a1_0x4e66('0x20')]>0x0){const _0x5b6e4c=_0x2c1180[a1_0x4e66('0x19')](environment_1[a1_0x4e66('0x40')],_0x459feb);for(const _0x3de7ec of _0x459feb){_0x1e701c[a1_0x4e66('0x30')][_0x3de7ec]=_0x5b6e4c;}}});}function isConnectedToPrivateCloud(_0x513630){if(!_0x513630[a1_0x4e66('0x3e')])return![];if(_0x513630[a1_0x4e66('0x3e')][a1_0x4e66('0x1e')](a1_0x4e66('0x3a')))return![];if(_0x513630[a1_0x4e66('0x3e')]['endsWith']('.nx.app'))return![];if(_0x513630['url'][a1_0x4e66('0x42')](a1_0x4e66('0xe'))>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x7ea89e,_0x3d0cee,_0x21b343,_0x559dae=![]){var _0x5320db;const _0x2fdce6={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x7ea89e};const _0x3de525=_0x3d0cee[a1_0x4e66('0x3b')]===undefined;const _0x56e706=[];const _0x377122=new message_reporter_1['MessageReporter'](_0x3d0cee);const _0x3f6e29=createApi(_0x377122,_0x3d0cee,_0x2fdce6);const _0x108d14=new end_of_run_message_1[(a1_0x4e66('0x3d'))](_0x2fdce6,_0x56e706);const _0x4ffc3b=new output_obfuscator_1['OutputObfuscator'](_0x3d0cee[a1_0x4e66('0x13')]);const _0x6447df=new Date()[a1_0x4e66('0x35')]();const _0x4c8d13=createLifeCycle(_0x2fdce6,_0x3d0cee,_0x4ffc3b,_0x56e706);const _0x4511b2=environment_1['ENCRYPTION_KEY']||_0x3d0cee[a1_0x4e66('0x1a')];const _0x1c4770=new e2e_encryption_1[(a1_0x4e66('0x4e'))](_0x4511b2);const _0x36a2b1=new error_reporter_api_1['ErrorReporterApi'](_0x3d0cee);const _0x186675=!!environment_1[a1_0x4e66('0x23')]||!((_0x5320db=_0x21b343['daemon'])===null||_0x5320db===void 0x0?void 0x0:_0x5320db[a1_0x4e66('0x14')]())||isConnectedToPrivateCloud(_0x3d0cee);const _0x3feabf=new file_storage_1['FileStorage'](_0x1c4770,_0x36a2b1,![],_0x186675);const _0x7d41d2=new cloud_remote_cache_1[(a1_0x4e66('0x3f'))](_0x377122,_0x3f6e29,_0x2fdce6,_0x3feabf);fetchUrlsForKnownHashesUpfront(_0x3f6e29,_0x2fdce6,_0x7ea89e,_0x3d0cee);delete process[a1_0x4e66('0x4c')][a1_0x4e66('0x40')];const _0x344633=tasksRunner(_0x7ea89e,Object[a1_0x4e66('0x21')](Object[a1_0x4e66('0x21')]({},_0x3d0cee),{'remoteCache':_0x7d41d2,'lifeCycle':_0x4c8d13}),_0x21b343);if(_0x344633['subscribe']){const {Subject}=require(a1_0x4e66('0x46'));const _0x19e1b0=new Subject();_0x344633[a1_0x4e66('0x26')]({'next':_0x333d93=>_0x19e1b0[a1_0x4e66('0x2d')](_0x333d93),'error':_0x16bcd0=>_0x19e1b0[a1_0x4e66('0x37')](_0x16bcd0),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x21b343[a1_0x4e66('0x50')],'lifeCycle':_0x4c8d13,'options':_0x3d0cee,'remoteCache':_0x7d41d2,'api':_0x3f6e29,'outputObfuscator':_0x4ffc3b,'runStartTime':_0x6447df,'messages':_0x377122,'endOfRunMessage':_0x108d14,'taskExecutions':_0x56e706,'versionOfNxBefore133':_0x3de525,'inner':_0x559dae,'encryptionKey':_0x4511b2,'fileStorage':_0x3feabf,'uploadInCurrentProcess':_0x186675,'runContext':_0x2fdce6});_0x19e1b0['complete']();})});return _0x19e1b0;}else{return _0x344633['then'](_0x165824=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x21b343[a1_0x4e66('0x50')],'lifeCycle':_0x4c8d13,'options':_0x3d0cee,'remoteCache':_0x7d41d2,'api':_0x3f6e29,'outputObfuscator':_0x4ffc3b,'runStartTime':_0x6447df,'messages':_0x377122,'endOfRunMessage':_0x108d14,'taskExecutions':_0x56e706,'versionOfNxBefore133':_0x3de525,'inner':_0x559dae,'encryptionKey':_0x4511b2,'fileStorage':_0x3feabf,'uploadInCurrentProcess':_0x186675,'runContext':_0x2fdce6});return _0x165824;}))[a1_0x4e66('0x28')](_0x532b50=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x21b343[a1_0x4e66('0x50')],'lifeCycle':_0x4c8d13,'options':_0x3d0cee,'remoteCache':_0x7d41d2,'api':_0x3f6e29,'outputObfuscator':_0x4ffc3b,'runStartTime':_0x6447df,'messages':_0x377122,'endOfRunMessage':_0x108d14,'taskExecutions':_0x56e706,'versionOfNxBefore133':_0x3de525,'inner':_0x559dae,'encryptionKey':_0x4511b2,'fileStorage':_0x3feabf,'uploadInCurrentProcess':_0x186675,'runContext':_0x2fdce6});throw _0x532b50;}));}}exports['cloudEnabledTasksRunner']=cloudEnabledTasksRunner;