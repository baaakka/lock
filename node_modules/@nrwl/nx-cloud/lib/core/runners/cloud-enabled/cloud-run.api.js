const a3_0x5ea5=['../../../utilities/metric-logger','RunEnd.\x20Completed\x20tasks','runUrl','message','Stack\x20Trace:','Invalid\x20end\x20run\x20response:\x20','Invalid\x20Nx\x20Cloud\x20response:\x20','zlib','response','success','assign','util','apply','endRun','RunStart\x20duration','apiError','gzip','urls','done','axiosException','Run\x20completion\x20responded\x20with\x20`undefined`.','string','map','getRunGroup','Invalid\x20end\x20run\x20response','unknown','stringify','createReqBody','printDuration','mapRespToPerfEntry','data','...','axiosMultipleTries','parse','then','api','toString','nxCloudVersion','RunEnd\x20duration','stack','../../../utilities/axios','readFileSync','next','CloudRunApi','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','slice','post','__awaiter','apiAxiosInstance','devDependencies','getBranch','application/octet-stream','status','Run\x20Details:','note','promisify','throw','value','terminalOutput','createMetricRecorder','extractErrorMessage','messages','package.json','../../../utilities/nx-imports','recordMetric','VERBOSE_LOGGING','RUNNER_FAILURE_PERF_ENTRY','startRun','/nx-cloud/runs/start'];(function(_0x4179fa,_0x5ea55d){const _0x50a0b6=function(_0x238603){while(--_0x238603){_0x4179fa['push'](_0x4179fa['shift']());}};_0x50a0b6(++_0x5ea55d);}(a3_0x5ea5,0x177));const a3_0x50a0=function(_0x4179fa,_0x5ea55d){_0x4179fa=_0x4179fa-0x0;let _0x50a0b6=a3_0x5ea5[_0x4179fa];return _0x50a0b6;};'use strict';var __awaiter=this&&this[a3_0x50a0('0x11')]||function(_0x3a4ffb,_0x1746f1,_0x4c4c85,_0x189821){function _0x55a7c4(_0x34972e){return _0x34972e instanceof _0x4c4c85?_0x34972e:new _0x4c4c85(function(_0x1b075f){_0x1b075f(_0x34972e);});}return new(_0x4c4c85||(_0x4c4c85=Promise))(function(_0x32a886,_0x5c6f6e){function _0x385018(_0x11a4e1){try{_0x25a9a3(_0x189821[a3_0x50a0('0xc')](_0x11a4e1));}catch(_0x30c0e7){_0x5c6f6e(_0x30c0e7);}}function _0x164a38(_0x3c5417){try{_0x25a9a3(_0x189821[a3_0x50a0('0x1a')](_0x3c5417));}catch(_0x23b4b6){_0x5c6f6e(_0x23b4b6);}}function _0x25a9a3(_0x391c60){_0x391c60[a3_0x50a0('0x39')]?_0x32a886(_0x391c60[a3_0x50a0('0x1b')]):_0x55a7c4(_0x391c60[a3_0x50a0('0x1b')])[a3_0x50a0('0x4')](_0x385018,_0x164a38);}_0x25a9a3((_0x189821=_0x189821[a3_0x50a0('0x33')](_0x3a4ffb,_0x1746f1||[]))['next']());});};Object['defineProperty'](exports,'__esModule',{'value':!![]});exports[a3_0x50a0('0xd')]=void 0x0;const axios_1=require(a3_0x50a0('0xa'));const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require(a3_0x50a0('0x2e'));const util_1=require(a3_0x50a0('0x32'));const metric_logger_1=require(a3_0x50a0('0x27'));const {output}=require(a3_0x50a0('0x21'));class CloudRunApi{constructor(_0x2bbf85,_0x4d0603,_0x3b1198,_0x766918){this[a3_0x50a0('0x1f')]=_0x2bbf85;this['runContext']=_0x4d0603;this['machineInfo']=_0x766918;this[a3_0x50a0('0x12')]=(0x0,axios_1['createApiAxiosInstance'])(_0x3b1198);}['startRun'](_0x2ae607,_0x3d6b0c){var _0x157f73;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5a0725=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x50a0('0x25'));try{const _0x109431={'meta':{'nxCloudVersion':this[a3_0x50a0('0x7')]()},'branch':(0x0,environment_1[a3_0x50a0('0x14')])(),'runGroup':(0x0,environment_1[a3_0x50a0('0x3e')])(),'distributedExecutionId':_0x2ae607,'hashes':_0x3d6b0c};if(environment_1['VERBOSE_LOGGING']){output[a3_0x50a0('0x18')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x50a0('0x41')](_0x109431,null,0x2)]});}const _0xd1e45c=yield(0x0,axios_1['printDuration'])(a3_0x50a0('0x35'),()=>(0x0,axios_1[a3_0x50a0('0x2')])(()=>this[a3_0x50a0('0x12')][a3_0x50a0('0x10')](a3_0x50a0('0x26'),_0x109431)));_0x5a0725[a3_0x50a0('0x22')]((0x0,metric_logger_1[a3_0x50a0('0x44')])(_0xd1e45c));if(_0xd1e45c[a3_0x50a0('0x0')]&&_0xd1e45c[a3_0x50a0('0x0')][a3_0x50a0('0x2a')]){this[a3_0x50a0('0x1f')][a3_0x50a0('0x2a')]=_0xd1e45c['data'][a3_0x50a0('0x2a')];}if(!_0xd1e45c['data']||!_0xd1e45c[a3_0x50a0('0x0')][a3_0x50a0('0x38')]){this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')]=a3_0x50a0('0x2d')+JSON[a3_0x50a0('0x41')](_0xd1e45c[a3_0x50a0('0x0')]);return{};}return _0xd1e45c[a3_0x50a0('0x0')]['urls'];}catch(_0x1a3976){_0x5a0725[a3_0x50a0('0x22')](((_0x157f73=_0x1a3976===null||_0x1a3976===void 0x0?void 0x0:_0x1a3976['axiosException'])===null||_0x157f73===void 0x0?void 0x0:_0x157f73[a3_0x50a0('0x2f')])?(0x0,metric_logger_1[a3_0x50a0('0x44')])(_0x1a3976[a3_0x50a0('0x3a')]['response']):metric_logger_1[a3_0x50a0('0x24')]);this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')]=this['messages'][a3_0x50a0('0x1e')](_0x1a3976,'api');return{};}});}[a3_0x50a0('0x42')](_0x181fb8,_0x2dc12d,_0x3becda){const _0x5f47d4={'meta':{'nxCloudVersion':this[a3_0x50a0('0x7')]()},'tasks':_0x2dc12d,'run':_0x181fb8,'linkId':_0x3becda,'machineInfo':this['machineInfo']};return JSON['stringify'](_0x5f47d4);}[a3_0x50a0('0x34')](_0xee2d35,_0x1599d2,_0x5190c4){var _0x481ab0,_0xa21a19;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')])return![];let _0x236ff3=this[a3_0x50a0('0x42')](_0xee2d35,_0x1599d2,_0x5190c4);if(_0x236ff3['length']>0x14*0x3e8*0x3e8){_0x236ff3=this[a3_0x50a0('0x42')](_0xee2d35,_0x1599d2[a3_0x50a0('0x3d')](_0x43af01=>Object[a3_0x50a0('0x31')](Object[a3_0x50a0('0x31')]({},_0x43af01),{'hashDetails':undefined})));}const _0x42207b=Buffer['from'](_0x236ff3);const _0x55340b=yield(0x0,util_1[a3_0x50a0('0x19')])(zlib_1['gzip'])(_0x42207b);const _0x1d42f4=(0x0,metric_logger_1[a3_0x50a0('0x1d')])(a3_0x50a0('0x34'));try{if(environment_1['VERBOSE_LOGGING']){const _0x3be0db=_0x1599d2[a3_0x50a0('0x3d')](_0x39ac10=>{return Object['assign'](Object[a3_0x50a0('0x31')]({},_0x39ac10),{'terminalOutput':_0x39ac10[a3_0x50a0('0x1c')]?_0x39ac10[a3_0x50a0('0x1c')][a3_0x50a0('0xf')](0x0,0x14)+a3_0x50a0('0x1'):undefined});});output[a3_0x50a0('0x18')]({'title':a3_0x50a0('0x28'),'bodyLines':['\x0a'+JSON[a3_0x50a0('0x41')](_0x3be0db,null,0x2)]});}const _0x3e5ff3=yield(0x0,axios_1[a3_0x50a0('0x43')])(a3_0x50a0('0x8'),()=>(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x50a0('0x12')][a3_0x50a0('0x10')]('/nx-cloud/runs/end',_0x55340b,{'headers':Object[a3_0x50a0('0x31')](Object[a3_0x50a0('0x31')]({},this[a3_0x50a0('0x12')]['defaults']['headers']),{'Content-Encoding':a3_0x50a0('0x37'),'Content-Type':a3_0x50a0('0x15')})})));if(_0x3e5ff3){_0x1d42f4[a3_0x50a0('0x22')]((0x0,metric_logger_1[a3_0x50a0('0x44')])(_0x3e5ff3));if(_0x3e5ff3[a3_0x50a0('0x0')]&&_0x3e5ff3[a3_0x50a0('0x0')][a3_0x50a0('0x29')]&&_0x3e5ff3[a3_0x50a0('0x0')]['status']==='success'){this['runContext'][a3_0x50a0('0x29')]=_0x3e5ff3['data'][a3_0x50a0('0x29')];return!![];}if(_0x3e5ff3[a3_0x50a0('0x0')]&&_0x3e5ff3[a3_0x50a0('0x0')][a3_0x50a0('0x16')]){this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')]=a3_0x50a0('0x2c')+JSON[a3_0x50a0('0x41')](_0x3e5ff3[a3_0x50a0('0x0')][a3_0x50a0('0x2a')]);}else if(_0x3e5ff3[a3_0x50a0('0x0')]&&typeof _0x3e5ff3['data']===a3_0x50a0('0x3c')){if(_0x3e5ff3['data']!==a3_0x50a0('0x30')){this[a3_0x50a0('0x1f')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x50a0('0x41')](_0x3e5ff3[a3_0x50a0('0x0')]);}}else{this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')]=a3_0x50a0('0x2c')+JSON[a3_0x50a0('0x41')](_0x3e5ff3[a3_0x50a0('0x0')]);}if(environment_1[a3_0x50a0('0x23')]){output['note']({'title':a3_0x50a0('0x3f'),'bodyLines':[JSON[a3_0x50a0('0x41')](_0x3e5ff3['data'],null,0x2)]});}}else{output['error']({'title':a3_0x50a0('0xe'),'bodyLines':[a3_0x50a0('0x3b'),a3_0x50a0('0x17'),JSON[a3_0x50a0('0x41')](_0xee2d35,null,0x2),a3_0x50a0('0x2b'),JSON['stringify'](new Error()[a3_0x50a0('0x9')],null,0x2)]});}return![];}catch(_0x831a8e){_0x1d42f4[a3_0x50a0('0x22')](((_0x481ab0=_0x831a8e===null||_0x831a8e===void 0x0?void 0x0:_0x831a8e[a3_0x50a0('0x3a')])===null||_0x481ab0===void 0x0?void 0x0:_0x481ab0[a3_0x50a0('0x2f')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x831a8e[a3_0x50a0('0x3a')]['response']):metric_logger_1[a3_0x50a0('0x24')]);const _0x4126af=(_0xa21a19=_0x831a8e[a3_0x50a0('0x3a')])!==null&&_0xa21a19!==void 0x0?_0xa21a19:_0x831a8e;this[a3_0x50a0('0x1f')][a3_0x50a0('0x36')]=this[a3_0x50a0('0x1f')][a3_0x50a0('0x1e')](_0x4126af,a3_0x50a0('0x5'));return![];}});}[a3_0x50a0('0x7')](){try{const _0x353aca=JSON[a3_0x50a0('0x3')]((0x0,fs_1[a3_0x50a0('0xb')])(a3_0x50a0('0x20'))[a3_0x50a0('0x6')]());return _0x353aca[a3_0x50a0('0x13')]['@nrwl/nx-cloud'];}catch(_0x2b8719){return a3_0x50a0('0x40');}}}exports[a3_0x50a0('0xd')]=CloudRunApi;